<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>$title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="$relpath/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="$relpath/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<table><tr><td><img class="header" src="LEGO.jpg"></td><td><h1>&nbsp;&nbsp;&nbsp;LEGO Mindstorms EV3</h1></td></tr></table><hr size="1"/>
<!-- Generated by Doxygen 1.8.7 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">Firmware Documentation</a></li><li class="navelem"><a class="el" href="buildinapps.html">Apps</a></li><li class="navelem"><a class="el" href="makingapps.html">Making Apps with the "lmsasm" Tool</a></li><li class="navelem"><a class="el" href="lmsassembler.html">lmsasm tool</a></li><li class="navelem"><a class="el" href="bytecodes.html">Byte Codes</a></li>  </ul>
</div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><hr/>
<p> <b> opTST (CMD, ....) </b></p>
<ul>
<li>System test functions entry<br />
</li>
<li>This set of commands are for test only as they change behaviour in some driver modules. When test is open every command keeps the test byte codes enabled for 10 seconds <br />
 <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">(DATA8)</td><td>CMD - <a class="el" href="tstsubcode.html">Specific command parameter</a></td></tr>
  </table>
  </dd>
</dl>
<br />
<ul>
<li>CMD = TST_OPEN <br />
 Enables test byte codes for 10 seconds<br />
 <br />
</li>
<li>CMD = TST_CLOSE <br />
 Disables test byte codes<br />
 <br />
</li>
<li>CMD = TST_READ_PINS <br />
 Read connector pin status<br />
<ul>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">(DATA8)</td><td>PORT - Input connector [0..3], output connector [16..19]<br />
</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">(DATA8)</td><td>LENGTH - Number of pins in returned string<br />
</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="section return"><dt>Returns</dt><dd>(DATA8) STRING - String variable start index ('0' = low, '1' = high)<br />
 <br />
 <br />
 Input<br />
 -----&mdash;<br />
 STRING[0] Pin1 I_ONx current source control output ['0','1']<br />
 STRING[1] Pin2 LEGDETx ['0','1']<br />
 STRING[2] Pin5 DIGIx0 ['0','1']<br />
 STRING[3] Pin6 DIGIx1 ['0','1']<br />
 STRING[4] - TXINx_EN ['0','1']<br />
 <br />
 Output<br />
 -----&mdash;<br />
 STRING[0] Pin1 MxIN0 ['0','1']<br />
 STRING[1] Pin2 MxIN1 ['0','1']<br />
 STRING[2] Pin5 DETx0 ['0','1']<br />
 STRING[3] Pin5 INTx0 ['0','1']<br />
 STRING[4] Pin6 DIRx ['0','1']<br />
</dd></dl>
<br />
</li>
</ul>
</li>
<li>CMD = TST_WRITE_PINS <br />
 Write to connector pin<br />
<ul>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">(DATA8)</td><td>PORT - Input connector [0..3], output connector [16..19]<br />
</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">(DATA8)</td><td>LENGTH - Number of pins to write<br />
</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="section return"><dt>Returns</dt><dd>(DATA8) STRING - String variable start index ('0' = set low, '1' = set high, 'X' = tristate, '-' = don't touch)<br />
 <br />
 <br />
 Input<br />
 -----&mdash;<br />
 STRING[0] Pin1 I_ONx current source control output ['0','1','X','-']<br />
 STRING[1] Pin2 LEGDETx ['0','1','X','-']<br />
 STRING[2] Pin5 DIGIx0 ['0','1','X','-']<br />
 STRING[3] Pin6 DIGIx1 ['0','1','X','-']<br />
 STRING[4] - TXINx_EN ['0','1','X','-']<br />
 <br />
 Output<br />
 -----&mdash;<br />
 STRING[0] Pin1 MxIN0 ['0','1','X','-']<br />
 STRING[1] Pin2 MxIN1 ['0','1','X','-']<br />
 STRING[2] Pin5 DETx0 Write ['0','1','X','-']<br />
 STRING[3] Pin5 INTx0 Read ['0','1','X','-']<br />
 STRING[4] Pin6 DIRx ['0','1','X','-']<br />
</dd></dl>
<br />
</li>
</ul>
</li>
<li>CMD = TST_READ_ADC <br />
 Read raw count from ADC<br />
<ul>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">(DATA8)</td><td>INDEX - Input mapped index (see below) [0..15]<br />
</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="section return"><dt>Returns</dt><dd>(DATA16) VALUE - Raw count [0..4095]<br />
 <br />
 <br />
 INDEX 0..3 Input connector pin 1 ( 0=conn1, 1=conn2, 2=conn3, 3=conn4)<br />
 INDEX 4..7 Input connector pin 6 ( 4=conn1, 5=conn2, 6=conn3, 7=conn4)<br />
 INDEX 8..11 Output connector pin 5 ( 8=conn1, 9=conn2, 10=conn3, 11=conn4)<br />
 <br />
 INDEX 12 Battery temperature<br />
 INDEX 13 Current flowing to motors<br />
 INDEX 14 Current flowing from the battery<br />
 INDEX 15 Voltage at battery cell 1, 2, 3,4, 5, and 6<br />
</dd></dl>
<br />
</li>
</ul>
</li>
<li>CMD = TST_ENABLE_UART <br />
 Enable all UARTs<br />
<ul>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">(DATA32)</td><td>BITRATE - Bit rate [2400..115200 b/S]<br />
</td></tr>
  </table>
  </dd>
</dl>
<br />
</li>
</ul>
</li>
<li>CMD = TST_WRITE_UART <br />
 Write data to port through UART<br />
<ul>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">(DATA8)</td><td>PORT - Input connector [0..3]<br />
</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">(DATA8)</td><td>LENGTH - Length of string to write [0..63]<br />
</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">(DATA8)</td><td>STRING - String of data<br />
</td></tr>
  </table>
  </dd>
</dl>
<br />
</li>
</ul>
</li>
<li>CMD = TST_READ_UART <br />
 Read data from port through UART<br />
<ul>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">(DATA8)</td><td>PORT - Input connector [0..3]<br />
</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">(DATA8)</td><td>LENGTH - Length of string to read [0..63]<br />
</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">(DATA8)</td><td>STRING - String of data<br />
</td></tr>
  </table>
  </dd>
</dl>
<br />
</li>
</ul>
</li>
<li>CMD = TST_DISABLE_UART <br />
 Disable all UARTs<br />
</li>
</ul>
</li>
</ul>
<p><br />
</p><ul>
<li>CMD = TST_ACCU_SWITCH <br />
 Read accu switch state<br />
<ul>
<li><dl class="section return"><dt>Returns</dt><dd>(DATA8) ACTIVE - State [0..1]<br />
</dd></dl>
<br />
</li>
</ul>
</li>
<li>CMD = TST_BOOT_MODE" <br />
 Turn on mode2<br />
</li>
</ul>
<p><br />
</p><ul>
<li>CMD = TST_POLL_MODE2 <br />
 Read mode2 status<br />
<ul>
<li><dl class="section return"><dt>Returns</dt><dd>(DATA8) STATUS - State [0..2]<br />
</dd></dl>
<br />
</li>
</ul>
</li>
<li>CMD = TST_CLOSE_MODE2 <br />
 Closes mode2<br />
</li>
</ul>
<p><br />
</p><ul>
<li>CMD = TST_RAM_CHECK <br />
 Read RAM test status status<br />
<ul>
<li><dl class="section return"><dt>Returns</dt><dd>(DATA8) STATUS - State [0,1] 0 = FAIL, 1 = SUCCESS<br />
</dd></dl>
<br />
 <hr/>
 <b>Direct test command examples:</b> <pre class="fragment">*

--------------------------------------
Set DIGIBI0, low
--------------------------------------
              v
12000000000000FF0AFF0D0105842D2D302D2D00

0300000002

--------------------------------------
Set DIGIBI0, high
--------------------------------------
              v
12000000000000FF0AFF0D0105842D2D312D2D00

0300000002

--------------------------------------
Set DIGIBI0, float
--------------------------------------
              v
12000000000000FF0AFF0D0105842D2D582D2D00

0300000002

--------------------------------------
Read ADC value, Port 2, Pin 6
--------------------------------------
              v
0B000000000200FF0AFF0E0560

0500000002xxxx
xxxx  = A/D count [0..4095]

--------------------------------------
Activate 9V, Input Port 2
--------------------------------------
              v
12000000000000FF0AFF0D010584312D2D2D2D00

0300000002

--------------------------------------
Read ADC value, Port 2, Pin 1
--------------------------------------
              v
0B000000000200FF0AFF0E0160

0500000002xxxx
xxxx  = A/D count [0..4095]

--------------------------------------
Deactivate 9V, Input Port 2
--------------------------------------
              v
12000000000000FF0AFF0D010584302D2D2D2D00

0300000002

--------------------------------------
Transmit and receive "UUUUU" on Port 2
--------------------------------------
              v
20000000000500FF0AFF118300C20100FF0F010584555555555500FF10010560FF12

0800000002xxxxxxxxxx
xxxxxxxxxx = 5555555555 = "UUUUU"

--------------------------------------
Read rechargeable battery availability
--------------------------------------
              v
0A000000000100FF0AFF1360

0400000002xx
xx    = SW1     xx = 00 not active, xx = 01 active


--------------------------------------
Check for mode2
--------------------------------------

Initiate mode2:
              v
09000000000000FF0AFF14

0300000002


Poll mode2 status:
              v
0A000000000100FF0AFF1560

0400000002xx

xx = Mode2 status  xx = 00 success, xx = 01 in progress, xx = 02 error


Close mode2:
              v
09000000000000FF0AFF16

0300000002

--------------------------------------
RAM Check poll
--------------------------------------

Poll RAM check:
              v
0A000000000100FF0AFF1760

0400000002xx

xx = RAM check  xx = 00 OK, xx = 02 FAIL


****************************************************************
**** OTHER FUNCTIONS WITH NORMAL BYTE CODES ********************
****************************************************************

--------------------------------------
Read UI Button status
--------------------------------------
              v
1D000000000600830901608309026183090362830904638309056483090665

0900000002uueeddrrllbb
uu    = up      uu = 00 not active, uu = 01 active
ee    = enter   ee = 00 not active, ee = 01 active
dd    = down    dd = 00 not active, dd = 01 active
rr    = right   rr = 00 not active, rr = 01 active
ll    = left    ll = 00 not active, ll = 01 active
bb    = back    bb = 00 not active, bb = 01 active

--------------------------------------
Tone 1 KHz, forever
--------------------------------------
              v
0D0000000000009401816482E80300

0300000002

--------------------------------------
Stop Sound output
--------------------------------------
              v
070000000000009400

0300000002

--------------------------------------
Show Chess pattern 1 (start with black)
--------------------------------------
              v
160000000000008412008413000000841382550000008400

0300000002

--------------------------------------
Show Chess pattern 1 (start with white)
--------------------------------------
              v
160000000000008412008413000000841382AA0000008400

0300000002

--------------------------------------
Clear display again
--------------------------------------
              v
0C00000000000084130000008400

0300000002

--------------------------------------
Check for SD card
--------------------------------------
              v
0A000000000900811E686064

0C00000002ttttttttffffffffpp
tttttttt = total size
ffffffff = free space
pp       = present [00 = no, 01 = yes]

--------------------------------------
Bluetooth on and visible
--------------------------------------
              v
13000000000000D4010201D00200D4020201D00200

0300000002

--------------------------------------
Bluetooth off
--------------------------------------
              v
0C000000000000D4010200D00200

0300000002

*</pre> </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
<hr size="1"/><address style="text-align: center;">
LEGO&reg Robotics Firmware Documentation<br/>Confidential Information &copy 2013 The LEGO Group</address>
</body>
</html>
