<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>UART Device Controller</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="$relpath/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="$relpath/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<table><tr><td><img class="header" src="LEGO.jpg"></td><td><h1>&nbsp;&nbsp;&nbsp;LEGO Mindstorms EV3</h1></td></tr></table><hr size="1"/>
<!-- Generated by Doxygen 1.8.7 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">Firmware Documentation</a></li><li class="navelem"><a class="el" href="interestingstuff.html">Interesting Stuff</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">UART Device Controller </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><hr/>
<p>Manages the sequence necessary when adding a UART devices to an input port.<br />
 <br />
 The UART Device Controller gets information from the DCM driver <a class="el" href="DcmDriver.html">Device Detection Manager Driver</a> about the port state and when the DCM driver detects a UART device on the port the sequence below the following defines is started inside the UART Device Controller.</p>
<pre class="fragment">*/

#define   LOWEST_BITRATE                2400  //  Lowest possible bit rate (always used for sync and info)  [b/S]
#define   MIDLE_BITRATE                57600  //  Highest bit rate allowed when adjusting clock             [b/S]
#define   HIGHEST_BITRATE             460800  //  Highest possible bit rate                                 [b/S]

/*
  SEQUENCE WHEN UART DEVICE IS DETECTED
  =====================================

        HOST                                                                                DEVICE
    ------------------------------------------------------------        ----------------------------------------------------------------------
                                                                                        - Reset                 &lt;----------------------------,
                                                                                          - Set TX active (low)                              |
                                                                                          - Set RX floating                                  |
                                                                                          - Wait half a second 1st.time (next time &gt;=10mS)   |
                                                                                                                                             |
    - Enable UART communication                                                         - Enable UART communication                          |
      - Setup UART for LOWEST_BITRATE                                                     - Setup UART for LOWEST_BITRATE                    |
      - Setup hardware buffers                                                                                                               |
                                                                                                                                             |
                                                                                                                                             |
    - Exchange informations                                                             - Exchange informations                              |
      - Receive command data                                         &lt;-- CMD              - Send command data (type,modes,speed, etc)        |
      - Send command data (type,modes,speed, etc)           CMD  --&gt;                      - Receive command data                             |
      - Receive info data                                            &lt;-- INFO             - Send info data (name,scaling,data format, etc)   |
      - Send info data (name,scaling,data format, etc)      INFO --&gt;                      - Receive info data                                |
      - Receive acknowledge                                          &lt;-- ACK              - When finished info send acknowledge              |
                                                                                          - Timeout (80mS)      -----------------------------'
      - When finished info send acknowledge                 ACK  --&gt;                      - Receive acknowledge
      - Switch to valid communication speed                                               - Switch to valid communication speed


    - Communication running                                                              - Communication running
      - Receive data                                                 &lt;-- DATA             - Send data
      - Every 100mS, send watchdog service                  NACK --&gt;                      - If more than one of six messages is correct send NACK
      - Receive data                                                 &lt;-- DATA             - Send data
      - Receive data                                                 &lt;-- DATA             - Send data
      - Receive data                                                 &lt;-- DATA             - Send data
         --
      - Send command                                        CMD  --&gt;                      - Receive command
      - Receive data                                                 &lt;-- DATA             - Send data
      - Receive data                                                 &lt;-- DATA             - Send data
         --
      - Receive data                                                 &lt;-- DATA             - Send data
      - Every 100mS, send watchdog service                  NACK --&gt;                      - If more than one of six messages is correct send NACK
      - Receive data                                                 &lt;-- DATA             - Send data
      - Receive data                                                 &lt;-- DATA             - Send data
      - Receive data                                                 &lt;-- DATA             - Send data
         --


  DEVICES
  =======

  Devices should only send data when data changes at a maximum rate of 1mS and if the time elapsed since last change exceeds 100mS.
  Data should also be send after a watchdog service message has been received.
  If watchdog service (NACK) is not received within 1000 mS the device should reset.

  When placed wrong on an output port device TX should continue to transmit SYNC, INFO or DATA to ensure that the host detects
  that connection 6 is low</pre><p> <a class="el" href="UartProtocol.html#ExampleUartProtocol">Ex.</a> </p><pre class="fragment">  HOST
  ====

  The host sends a watchdog service message (NACK) every 100 mS if no error occours.
  The host should check every data message format against the info once sent from the device and leave out the watchdog service when the data
  is not valid within 6 messages.</pre> <pre class="fragment">\n</pre> </div></div><!-- contents -->
<hr size="1"/><address style="text-align: center;">
LEGO&reg Robotics Firmware Documentation<br/>Confidential Information &copy 2013 The LEGO Group</address>
</body>
</html>
